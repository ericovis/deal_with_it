<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Deal with it!</title>
  <link rel="icon" type="image/png" href="/images/favicon.png">
  <style media="screen">
  body {
    background-color: #f5f5f5;
    font-size: 20px;
  }
  img {
    max-width: 100%;
    height: auto;
  }
  .content {
    display: grid;
    grid-template-columns: auto;
    grid-gap: 10px;
    padding: 30px;
  }
  .content > div {
    text-align: center;
    width: 100%
  }
  .content > .form {
      width: 100%;
      display: inline-block;
  }
  input[type=text], select {
      width: 80%;
      padding: 12px 20px;
      font-size: 15px;
      margin: 8px 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
  }

  input[type=submit] {
      background-color: #4CAF50;

      font-size: 15px;
      color: white;
      padding: 12px 20px;
      margin: 8px 0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
  }

  input[type=submit]:hover {
      background-color: #45a049;
  }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>
    $(document).ready(function(){
      function isURL(str) {
        var pattern = new RegExp('^(https?:\\/\\/)?'+
        '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}|'+
        '((\\d{1,3}\\.){3}\\d{1,3}))'+
        '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+
        '(\\?[;&a-z\\d%_.~+=-]*)?'+
        '(\\#[-a-z\\d_]*)?$','i');
        return pattern.test(str);
      };
      $("#form").submit(function(e) {
          var url = "http://localhost:5000";
          e.preventDefault();
          if (isURL($('#img_url').val())){
          $.ajax({
                 type: "POST",
                 url: url,
                 dataType: "json",
                 contentType: "application/json; charset=UTF-8",
                 data: JSON.stringify({img_url: $('#img_url').val()}),
                 success: function(data)
                 {
                     var img_src = "data:image/png;base64," + data.body.media_data
                     $("#deal-with-me").attr("src", img_src);
                     $(".picture").show();
                 },
                 error: function(xhr, textStatus, errorThrown)
                 {
                    console.log(xhr);
                 }
               });
         };
      });
    });
  </script>
</head>
<body>
<div class="content">
  <div class="picture" hidden>
    <h3>Deal with it!</h3>
    <img alt="Deal with Me" id="deal-with-me">
  </div>
  <div class="form">
    <form id="form" method="post">
      <p>Image URL: </p>
      <input type="text" id="img_url" placeholder="https://url.to.my/image.jpg">
      <input type="submit" value="Deal with me">
    </form>
  </div>

</div>

</body>
</html>
